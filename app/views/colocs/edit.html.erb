<h1>Gestion de la coloc</h1>

<%= link_to "Revenir au Tach'board", ongoing_tasks_path %>

<p>Pour qu'un utilisateur rejoigne ta coloc, envoie-lui ce code : <%= @coloc.invite_token %></p>

<%= simple_form_for @coloc do |f| %>
  <%= f.input :name, label: false %>  
  <%= f.submit "Sauvegarder" %>  
<% end %>

<ul>
  <% @users.each do |user| %>
    <li>
      <%= cl_image_tag user.avatar.key, height: 25, width: 25 %>
      <%= user.username %>
      <% if user != @coloc.leader %>
        <%= link_to "X", remove_coloc_user_path(@coloc, user), method: :delete, data: { confirm: "Retirer #{user.username} de la coloc ?" } %>
      <% end %>
    </li>
  <% end %>
</ul>

<%= form_with model: @coloc do |form| %>
  <ul>
    <%= form.fields_for :coloc_tasks, form.object.coloc_tasks.order(:id) do |coloc_tasks_fields| %>
      <li>
        <div>
          <%= cl_image_tag coloc_tasks_fields.object.task.image.key, class:"task-content", height: 70, width: 70 %>
        </div>
        <div>
          <h3><%= coloc_tasks_fields.label coloc_tasks_fields.object.task.name %></h3>
          <label>
            <%= coloc_tasks_fields.select :difficulty, Task::DIFFICULTIES %>
          </label>
          <%= link_to "🗑️", coloc_task_path(coloc_tasks_fields.object), method: :delete, data: { confirm: "Retirer '#{coloc_tasks_fields.object.task.name}' de la coloc ? Tout l'historique sera définitivement supprimé." } %>
          <%= coloc_tasks_fields.hidden_field :task_id  %>
        </div>
      </li>
    <% end %>
  </ul>
  <div>
    <%= form.submit 'Sauvegarder', class: 'btn-primary' %>
  </div>
<% end %>
