<h1>Gestion de la coloc</h1>

<%= link_to "Revenir au Tach'board", ongoing_tasks_path %>

<p>Pour qu'un utilisateur rejoigne ta coloc, envoie-lui ce code : <%= @coloc.invite_token %></p>

<%= simple_form_for @coloc do |f| %>
  <%= f.input :name, label: false %>  
  <%= f.submit "Sauvegarder" %>  
<% end %>

<ul>
  <% @users.each do |user| %>
    <li>
      <%= cl_image_tag user.avatar.key, height: 25, width: 25 %>
      <%= user.username %>
      <% if user != @coloc.leader %>
        <%= link_to "X", remove_coloc_user_path(@coloc, user), method: :delete, data: { confirm: "Retirer #{user.username} de la coloc ?" } %>
      <% end %>
    </li>
  <% end %>
</ul>

<%= form_with model: @coloc do |form| %>
  <ul>
    <%= form.fields_for :coloc_tasks, form.object.coloc_tasks.order(:id) do |coloc_tasks_fields| %>
      <li>
        <div>
          <%= cl_image_tag coloc_tasks_fields.object.task.image.key, height: 70, width: 70 %>
        </div>
        <div>
          <h3><%= coloc_tasks_fields.label coloc_tasks_fields.object.task.name %></h3>
          <label>
            <%= coloc_tasks_fields.select :difficulty, Task::DIFFICULTIES %>
          </label>
          <%= link_to "üóëÔ∏è", coloc_coloc_task_path(@coloc, coloc_tasks_fields.object), method: :delete, data: { confirm: "Retirer '#{coloc_tasks_fields.object.task.name}' de la coloc ? Tout l'historique sera d√©finitivement supprim√©." } %>
          <%= coloc_tasks_fields.hidden_field :task_id  %>
        </div>
      </li>
    <% end %>
  </ul>
  <div>
    <%= form.submit 'Sauvegarder', class: 'btn-primary' %>
  </div>
<% end %>

<h2>Ajouter des t√¢ches √† la coloc</h2>

<%= simple_form_for [@coloc, @new_coloc_task] do |form| %>
  <% @addable_tasks.each do |addable_task| %>
    <%= fields_for "items[]", addable_task do |f| %>
      <div class="switch-task">
        <div>
          <%= cl_image_tag f.object.image.key, height: 130, width: 130 %>
        </div>
        <div class="toggle-name">
          <h3 class="violet-100"> <%= f.label f.object.name %> </h3>
          <label class="switch">
            <%= f.check_box  :task, { checked: false }, f.object.id %>
            <span class="slider round"></span>
          </label>
        </div>
      </div>
    <% end %>
  <% end %>
  <div class="text-center margin-t-64">
    <%= form.submit 'Ajouter les t√¢ches s√©lectionn√©es', class: 'btn-primary' %>
  </div>
<% end %>
